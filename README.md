# GazeVerificationStand

Тестовый вариант рабочего стенда для верификационной части Инструментального комплекса анализа движений глаз для задач интерактивной рефлекторной идентификации (ИРИ).

## Оглавление

0. [Общее описание](#Общее-описание)
1. [Состав модулей](#Состав-модулей)
    1. [Конфигурация и пути](#Конфигурация)
    2. [Запуск](#Запуск)
    3. [Обработка данных](#Обработка)
    4. [Классификация движений глаз](#Классификация-движений)
    5. [Генерация признаков](#Генерация-признаков)
    6. [Верификация](#Верификация)
    7. [Jupiter notebooks](#Jupiter-notebooks)
    8. [Визуализация](#Визуализация)
3. [Файловая структура](#Файловая-структура)
4. [Дополнения](#Дополнения)
  ____
  
## Общее описание

Стенд состоит из пяти логически и программно разделенных модулей. Каждый из них отвечает за отдельный реализованный алгоритм или обеспечивает корректное функционирование всей системы в целом.
* `Модуль конфигурации` - отвечает за конфигурационный файл, который используется для хранения настроек стенда.
* `Модуль запуска` - входная точка для запуска работы стенда с выбранной конфигурацией.
* `Модуль обработки данных` - реализует все необходимые утилиты и методы для работы с "сырыми" данными с трекера.
* `Модуль классификации движений глаз` - содержит алгоритм и сопутствующие ему функции для классификации временных рядов взглядов в последовательность определенных макродвижений человеческого глаза.
* `Модуль верификации личности` - отвечает непосредственно за реализацию самой процедуры идентификации человека как "владельца устройства".
* `Дополнительный модель с интерактивными Jupiter ноутбуками` - полезен для демонстрации промежуточных результатов пайплайна алгоритмов и оценки качества.

## Состав модулей

### Модуль конфигурации
#### Файл `config.py`
Содержит весь необходимый функционал для взаимодействия с конфигурационным файлом (по умолчанию, это файл в корневой папке `set_locations.ini`).

Основной функционал:
+ `init_config` - инциализация конфигурационного файла при запуске, если он не найден происходит создание такого файла с дефолтными настройками.
+ `create_config` - метод для создания конфигурационного файла
+ `update_setting` - метод позволяет обновить настройки или пути в файле
+ `delete_setting` - метод удаляет настройку или путь в файле

Конфигурационный файл следует инициализировать при запуске стенда в **любом** режиме функционирования. Он нужен для определения путей к настроечным файлам и папкам с данными.
```python
path = ".\\set_locations.ini"
init_config(path)
```

### Модуль запуска
#### Файл `main.py`
Основной файл для запуска стенда. Содержит корневой класс `VerificationStand` и позволяет выбрать режим, в котором будет функционировать стенд: 
+ `train` - режим обучения модели на подобранных обучающих данных и сохранение всех весов и настроек.
+ `run` - режим верификации, в данном режиме настройки загружаются из ранее сохраненных (в режиме обучения) файлов и выводятся результаты предсказания модели.

Запуск производится, например, следующим образом:
```python
if __name__ == "__main__":
    stand = VerificationStand(".\\set_locations.ini")
    stand.run("run")
```

### Модуль обработки данных
#### Файл `create_training_dataset.py`
Модуль отвечает за сбор и создание датасета. В данном контексте по "датасетом" понимается определенная структура данных, которая в необработанном виде хранится в различных папках и файлах, а при необходимости собирается и агрегируется в единый объект типа pd.DataFrame. 
Подразумевается входной формат файлов: `.csv` - для данных с айтрекера, и `.txt` - для метаданных.
Определены два типа:
+ `TrainDataset` - класс, отвечающих за сбор обучающего датасета.
+ `RunDataset`  - класс, отвечающих за сбор датасета для верификации. Данный тип данных может быть как размеченным - при известных целевых значениях, либо неразмеченным, когда только запускающий стенд знает истинные принадлежности файлов наблюдателям.

### Модуль классификации движений глаз
#### Модуль `eyemovements`
Данный модуль включает в себя все детали реализации алгоритма детектирования и классификации движений глаз (I-VDT).

### Модуль генерации признаков
#### Файл `generate_features.py`
Файл содержит процедуру генерации характерных признаков по отрезкам временных рядов следящих движений глаз. Требует использования библиотеки `tsfresh`. Параметры для создания признакового описания содержатся в настроечном файле: `settings/features_params.json`.

### Модуль верификации личности
#### Модуль `verification`
Основной модуль отвечающий за верификацию и включающий в себя как саму модель нейронной сети для нахождения близости векторов признаков, так и эвристики для агрегации данных метрик в отношении всего временного ряда записи.

### Дополнительный модель с интерактивными Jupiter ноутбуками
#### Модуль `notebooks`
Дополнительный функционал:
+ `Create User Splits.ipynb` - создает случайные разбиения пользовательских записей взглядов на обучающую (train), верификацинную (owner) и контрольную (run) части.
+ `EyeMovements Visualization.ipynb` - интерактивная визуализация классификации движений глаз.
+ `Quality Estimation.ipynb` - интерактивная визуализация качественных метрик модели верификации.

### Визуализация
#### Файл `visualization.py`
Файл содержит функции для генерации визуальных примеров, которые сохраняются в папку `output` в формате .html и открываются в дальнейшем через браузер.

## Файловая структура
